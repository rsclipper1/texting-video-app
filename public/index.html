<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TextingAI â€” Video Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #0a0a0b;
    --surface: #111114;
    --border: #1e1e24;
    --border-bright: #2e2e38;
    --text: #e8e8f0;
    --muted: #5a5a70;
    --accent-el: #19e68c;
    --accent-ai: #5b7fff;
    --accent-el-dim: rgba(25,230,140,0.12);
    --accent-ai-dim: rgba(91,127,255,0.12);
    --danger: #ff4f4f;
    --warn: #ffa040;
    --r: 14px;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html { font-size: 16px; scroll-behavior: smooth; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ NOISE OVERLAY â”€â”€ */
  body::before {
    content: '';
    position: fixed; inset: 0; z-index: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
    pointer-events: none;
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     LANDING PAGE
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #landing {
    position: relative; z-index: 1;
    min-height: 100vh;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 40px 20px;
    gap: 0;
  }

  /* glow blobs */
  .blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(120px);
    opacity: 0.18;
    pointer-events: none;
    animation: drift 12s ease-in-out infinite alternate;
  }
  .blob-green { width: 600px; height: 400px; background: var(--accent-el); top: -100px; left: -150px; }
  .blob-blue  { width: 500px; height: 400px; background: var(--accent-ai); bottom: -80px; right: -100px; animation-delay: -6s; }

  @keyframes drift {
    from { transform: translate(0,0) scale(1); }
    to   { transform: translate(30px, 20px) scale(1.05); }
  }

  .landing-inner {
    position: relative; z-index: 2;
    display: flex; flex-direction: column;
    align-items: center; gap: 32px;
    max-width: 680px; width: 100%;
  }

  .logo-mark {
    display: flex; align-items: center; gap: 12px;
    animation: fadeUp 0.6s ease both;
  }
  .logo-icon {
    width: 48px; height: 48px;
    background: linear-gradient(135deg, var(--accent-el), var(--accent-ai));
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
  }
  .logo-text { font-size: 1.3rem; font-weight: 800; letter-spacing: -0.5px; }

  .landing-headline {
    text-align: center;
    animation: fadeUp 0.6s 0.1s ease both;
  }
  .landing-headline h1 {
    font-size: clamp(2.2rem, 6vw, 3.8rem);
    font-weight: 800;
    line-height: 1.1;
    letter-spacing: -2px;
    background: linear-gradient(135deg, #fff 30%, var(--muted));
    -webkit-background-clip: text; background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 16px;
  }
  .landing-headline p {
    font-family: 'DM Mono', monospace;
    font-size: 0.95rem;
    color: var(--muted);
    line-height: 1.6;
    max-width: 480px;
    margin: 0 auto;
  }

  /* Provider cards */
  .provider-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    animation: fadeUp 0.6s 0.2s ease both;
  }

  .provider-cards {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 16px; width: 100%;
    animation: fadeUp 0.6s 0.3s ease both;
  }

  .provider-card {
    position: relative;
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--r);
    padding: 28px 24px;
    cursor: pointer;
    transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
    overflow: hidden;
    text-align: left;
  }
  .provider-card::before {
    content: '';
    position: absolute; inset: 0;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .provider-card.el::before  { background: var(--accent-el-dim); }
  .provider-card.ai::before  { background: var(--accent-ai-dim); }
  .provider-card:hover { transform: translateY(-3px); }
  .provider-card.el:hover { border-color: var(--accent-el); box-shadow: 0 0 30px rgba(25,230,140,0.12); }
  .provider-card.ai:hover { border-color: var(--accent-ai); box-shadow: 0 0 30px rgba(91,127,255,0.12); }
  .provider-card:hover::before { opacity: 1; }

  .provider-card-icon {
    width: 44px; height: 44px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; margin-bottom: 16px;
    position: relative;
  }
  .provider-card.el .provider-card-icon { background: var(--accent-el-dim); }
  .provider-card.ai .provider-card-icon { background: var(--accent-ai-dim); }

  .provider-card h3 {
    font-size: 1.1rem; font-weight: 700; margin-bottom: 6px;
    position: relative;
  }
  .provider-card.el h3 { color: var(--accent-el); }
  .provider-card.ai h3 { color: var(--accent-ai); }

  .provider-card p {
    font-family: 'DM Mono', monospace;
    font-size: 0.78rem; color: var(--muted); line-height: 1.5;
    position: relative;
  }

  .provider-card .tag {
    display: inline-block; margin-top: 14px;
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem; letter-spacing: 1px; text-transform: uppercase;
    padding: 4px 10px; border-radius: 20px;
    position: relative;
  }
  .provider-card.el .tag { background: var(--accent-el-dim); color: var(--accent-el); }
  .provider-card.ai .tag { background: var(--accent-ai-dim); color: var(--accent-ai); }

  .provider-card .cta-arrow {
    position: absolute; bottom: 20px; right: 20px;
    font-size: 1.4rem; opacity: 0.3;
    transition: opacity 0.2s, transform 0.2s;
  }
  .provider-card:hover .cta-arrow { opacity: 1; transform: translate(3px, -3px); }

  .landing-footer {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem; color: var(--muted);
    text-align: center;
    animation: fadeUp 0.6s 0.4s ease both;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     MAIN APP
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #app {
    display: none;
    position: relative; z-index: 1;
    min-height: 100vh;
  }

  /* Top nav */
  .app-nav {
    display: flex; align-items: center; justify-content: space-between;
    padding: 18px 32px;
    border-bottom: 1px solid var(--border);
    position: sticky; top: 0; z-index: 100;
    background: rgba(10,10,11,0.85);
    backdrop-filter: blur(14px);
  }
  .nav-brand { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1rem; }
  .nav-brand .icon { font-size: 1.3rem; }

  .provider-badge {
    display: flex; align-items: center; gap: 8px;
    font-family: 'DM Mono', monospace; font-size: 0.78rem;
    padding: 6px 14px; border-radius: 20px;
    border: 1px solid;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  .provider-badge:hover { opacity: 0.7; }
  .provider-badge.el { border-color: var(--accent-el); color: var(--accent-el); background: var(--accent-el-dim); }
  .provider-badge.ai { border-color: var(--accent-ai); color: var(--accent-ai); background: var(--accent-ai-dim); }
  .provider-badge .dot { width: 7px; height: 7px; border-radius: 50%; }
  .provider-badge.el .dot { background: var(--accent-el); }
  .provider-badge.ai .dot { background: var(--accent-ai); }

  /* Main layout */
  .app-body {
    max-width: 860px; margin: 0 auto;
    padding: 40px 24px 80px;
    display: flex; flex-direction: column; gap: 28px;
  }

  .page-title {
    font-size: 1.6rem; font-weight: 800; letter-spacing: -1px;
  }
  .page-title span {
    background: linear-gradient(90deg, var(--accent-el), var(--accent-ai));
    -webkit-background-clip: text; background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Form sections */
  .form-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--r);
    padding: 24px;
    display: flex; flex-direction: column; gap: 20px;
  }
  .section-title {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem; letter-spacing: 2px; text-transform: uppercase;
    color: var(--muted);
    padding-bottom: 14px;
    border-bottom: 1px solid var(--border);
  }

  .field { display: flex; flex-direction: column; gap: 8px; }
  .field label {
    font-size: 0.85rem; font-weight: 600; color: var(--text);
  }
  .field .hint {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem; color: var(--muted); margin-top: 2px;
  }

  input[type="text"], input[type="password"] {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border-bright);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.88rem;
    padding: 11px 14px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  input[type="text"]:focus, input[type="password"]:focus {
    border-color: #4a4a60;
    box-shadow: 0 0 0 3px rgba(255,255,255,0.04);
  }

  /* File upload zones */
  .upload-zone {
    border: 1.5px dashed var(--border-bright);
    border-radius: 10px;
    padding: 24px 20px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    position: relative;
  }
  .upload-zone:hover, .upload-zone.drag { border-color: #4a4a60; background: rgba(255,255,255,0.02); }
  .upload-zone input { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; }
  .upload-zone .uz-icon { font-size: 1.8rem; margin-bottom: 8px; }
  .upload-zone .uz-text { font-size: 0.85rem; font-weight: 600; }
  .upload-zone .uz-hint { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--muted); margin-top: 4px; }
  .upload-zone.has-file { border-style: solid; border-color: var(--border-bright); background: rgba(255,255,255,0.02); }
  .upload-zone.has-file .uz-text { color: var(--accent-el); }

  /* Theme toggle */
  .theme-toggle {
    display: flex; gap: 10px;
  }
  .theme-btn {
    flex: 1; padding: 12px;
    background: var(--bg); border: 1.5px solid var(--border-bright);
    border-radius: 8px; color: var(--muted);
    font-family: 'Syne', sans-serif; font-size: 0.9rem; font-weight: 600;
    cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .theme-btn:hover { border-color: #4a4a60; color: var(--text); }
  .theme-btn.active.dark  { border-color: #888; background: rgba(255,255,255,0.05); color: var(--text); }
  .theme-btn.active.light { border-color: var(--accent-ai); background: var(--accent-ai-dim); color: var(--accent-ai); }

  /* Assets grid */
  .assets-grid {
    display: flex; flex-wrap: wrap; gap: 8px;
    min-height: 40px;
  }
  .asset-chip {
    display: flex; align-items: center; gap: 6px;
    background: var(--bg); border: 1px solid var(--border-bright);
    border-radius: 6px; padding: 5px 10px;
    font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--muted);
  }
  .asset-chip .remove {
    cursor: pointer; color: var(--muted); font-size: 1rem; line-height: 1;
    transition: color 0.15s;
  }
  .asset-chip .remove:hover { color: var(--danger); }

  /* Generate button */
  .gen-btn {
    width: 100%;
    padding: 16px 24px;
    border: none; border-radius: 10px;
    font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 700;
    cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    letter-spacing: -0.3px;
  }
  .gen-btn.el { background: linear-gradient(135deg, #0db870, var(--accent-el)); color: #000; }
  .gen-btn.ai { background: linear-gradient(135deg, #3355cc, var(--accent-ai)); color: #fff; }
  .gen-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
  .gen-btn:active { transform: translateY(0); }
  .gen-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

  /* Progress */
  #progress-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--r);
    padding: 24px;
    display: none; flex-direction: column; gap: 16px;
  }
  #progress-section.visible { display: flex; }

  .progress-header {
    display: flex; justify-content: space-between; align-items: center;
  }
  .progress-label { font-size: 0.9rem; font-weight: 600; }
  .status-pill {
    font-family: 'DM Mono', monospace; font-size: 0.7rem;
    padding: 4px 10px; border-radius: 20px; letter-spacing: 0.5px;
  }
  .status-pill.queued  { background: rgba(255,160,64,0.15); color: var(--warn); }
  .status-pill.running { background: var(--accent-ai-dim); color: var(--accent-ai); }
  .status-pill.done    { background: var(--accent-el-dim); color: var(--accent-el); }
  .status-pill.error   { background: rgba(255,79,79,0.15); color: var(--danger); }

  .progress-bar-track {
    height: 4px; background: var(--border-bright); border-radius: 2px; overflow: hidden;
  }
  .progress-bar-fill {
    height: 100%; width: 0%; border-radius: 2px;
    transition: width 0.5s ease;
    background: linear-gradient(90deg, var(--accent-el), var(--accent-ai));
  }
  .progress-bar-fill.indeterminate {
    width: 40%;
    animation: shimmer 1.5s ease-in-out infinite;
  }
  @keyframes shimmer {
    0%   { transform: translateX(-100%); }
    100% { transform: translateX(300%); }
  }

  .log-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px;
    height: 180px; overflow-y: auto;
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem; line-height: 1.7;
    color: var(--muted);
  }
  .log-box .log-line { color: var(--muted); }
  .log-box .log-line.ok  { color: var(--accent-el); }
  .log-box .log-line.err { color: var(--danger); }

  /* Download area */
  #download-section {
    display: none;
    background: var(--surface);
    border: 1px solid var(--accent-el);
    border-radius: var(--r);
    padding: 28px;
    text-align: center;
    animation: fadeUp 0.4s ease;
  }
  #download-section.visible { display: block; }
  #download-section h3 { font-size: 1.2rem; font-weight: 700; margin-bottom: 8px; color: var(--accent-el); }
  #download-section p  { font-family: 'DM Mono', monospace; font-size: 0.78rem; color: var(--muted); margin-bottom: 20px; }
  .dl-btn {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 12px 28px; border-radius: 8px; border: none;
    background: var(--accent-el); color: #000;
    font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.95rem;
    cursor: pointer; text-decoration: none;
    transition: opacity 0.2s, transform 0.2s;
  }
  .dl-btn:hover { opacity: 0.85; transform: translateY(-1px); }

  .error-box {
    background: rgba(255,79,79,0.08);
    border: 1px solid rgba(255,79,79,0.25);
    border-radius: 8px; padding: 14px 18px;
    font-family: 'DM Mono', monospace; font-size: 0.8rem; color: var(--danger);
    display: none;
  }
  .error-box.visible { display: block; }

  /* Responsive */
  @media (max-width: 500px) {
    .provider-cards { grid-template-columns: 1fr; }
    .app-nav { padding: 14px 16px; }
    .app-body { padding: 24px 16px 60px; }
    .form-section { padding: 18px; }
  }

  /* Spinner */
  .spin { display: inline-block; animation: spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LANDING PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="landing">
  <div class="blob blob-green"></div>
  <div class="blob blob-blue"></div>

  <div class="landing-inner">
    <div class="logo-mark">
      <div class="logo-icon">ğŸ’¬</div>
      <span class="logo-text">TextingAI</span>
    </div>

    <div class="landing-headline">
      <h1>Viral iMessage<br/>Videos, Instantly</h1>
      <p>Pick your voice engine, upload a script, and generate scroll-stopping texting content in minutes.</p>
    </div>

    <div class="provider-label">â€” Choose your TTS engine â€”</div>

    <div class="provider-cards">
      <!-- ElevenLabs -->
      <div class="provider-card el" onclick="selectProvider('elevenlabs')">
        <div class="provider-card-icon">ğŸ™ï¸</div>
        <h3>ElevenLabs</h3>
        <p>Industry-leading voice AI. Ultra-realistic voices with direct API access.</p>
        <span class="tag">Direct API</span>
        <span class="cta-arrow">â†—</span>
      </div>

      <!-- AI33Pro -->
      <div class="provider-card ai" onclick="selectProvider('ai33pro')">
        <div class="provider-card-icon">âš¡</div>
        <h3>AI33Pro</h3>
        <p>High-speed async TTS pipeline. Same voices, lower cost per generation.</p>
        <span class="tag">Fast Queue</span>
        <span class="cta-arrow">â†—</span>
      </div>
    </div>

    <p class="landing-footer">Both use ElevenLabs voice models under the hood &nbsp;Â·&nbsp; 30+ voices available</p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
  <nav class="app-nav">
    <div class="nav-brand">
      <span class="icon">ğŸ’¬</span>
      TextingAI
    </div>
    <div class="provider-badge" id="providerBadge" onclick="backToLanding()" title="Switch engine">
      <div class="dot"></div>
      <span id="providerBadgeText">â€”</span>
      <span style="opacity:0.5; margin-left:2px">â†©</span>
    </div>
  </nav>

  <div class="app-body">
    <div>
      <h1 class="page-title">Generate <span id="titleAccent">Video</span></h1>
      <p style="font-family:'DM Mono',monospace;font-size:0.8rem;color:var(--muted);margin-top:6px;">
        Fill in the fields below and hit generate.
      </p>
    </div>

    <!-- API KEY -->
    <div class="form-section">
      <div class="section-title">Authentication</div>
      <div class="field">
        <label>API Key</label>
        <input type="password" id="apiKey" placeholder="sk-..." autocomplete="off"/>
        <div class="hint" id="apiKeyHint">Enter your ElevenLabs or AI33Pro API key</div>
      </div>
    </div>

    <!-- SCRIPT -->
    <div class="form-section">
      <div class="section-title">Script & Assets</div>

      <div class="field">
        <label>Script File <span style="color:var(--danger)">*</span></label>
        <div class="upload-zone" id="scriptZone">
          <input type="file" id="scriptFile" accept=".txt" onchange="handleScript(this)"/>
          <div class="uz-icon">ğŸ“„</div>
          <div class="uz-text" id="scriptText">Drop your script.txt here</div>
          <div class="uz-hint">Plain text file with iMessage dialogue</div>
        </div>
      </div>

      <div class="field">
        <label>Assets <span style="color:var(--muted);font-weight:400">(images, sfx, avatar)</span></label>
        <div class="upload-zone" id="assetsZone">
          <input type="file" id="assetsFiles" multiple accept="image/*,.mp3,.wav" onchange="handleAssets(this)"/>
          <div class="uz-icon">ğŸ—‚ï¸</div>
          <div class="uz-text">Drop images & audio here</div>
          <div class="uz-hint">PNG, JPG, GIF, WebP, MP3, WAV â€” multiple allowed</div>
        </div>
        <div class="assets-grid" id="assetsGrid"></div>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="form-section">
      <div class="section-title">Settings</div>

      <div class="field">
        <label>Theme</label>
        <div class="theme-toggle">
          <button class="theme-btn active dark" id="btn-dark"  onclick="setTheme('dark')">ğŸŒ™ Dark</button>
          <button class="theme-btn light"        id="btn-light" onclick="setTheme('light')">â˜€ï¸ Light</button>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
        <div class="field">
          <label>Sent SFX</label>
          <div class="upload-zone" style="padding:14px" id="sentZone">
            <input type="file" id="sentSfx" accept=".mp3,.wav" onchange="handleSfx(this,'sent')"/>
            <div class="uz-icon" style="font-size:1.2rem;margin-bottom:4px">ğŸ“¤</div>
            <div class="uz-text" id="sentText" style="font-size:0.78rem">sent.mp3</div>
          </div>
        </div>
        <div class="field">
          <label>Received SFX</label>
          <div class="upload-zone" style="padding:14px" id="rcvdZone">
            <input type="file" id="rcvdSfx" accept=".mp3,.wav" onchange="handleSfx(this,'rcvd')"/>
            <div class="uz-icon" style="font-size:1.2rem;margin-bottom:4px">ğŸ“¥</div>
            <div class="uz-text" id="rcvdText" style="font-size:0.78rem">received.mp3</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ERROR -->
    <div class="error-box" id="errorBox"></div>

    <!-- GENERATE -->
    <button class="gen-btn" id="genBtn" onclick="generate()">
      <span id="genBtnIcon">â–¶</span>
      <span id="genBtnText">Generate Video</span>
    </button>

    <!-- PROGRESS -->
    <div class="form-section" id="progress-section">
      <div class="progress-header">
        <span class="progress-label">Processingâ€¦</span>
        <span class="status-pill running" id="statusPill">running</span>
      </div>
      <div class="progress-bar-track">
        <div class="progress-bar-fill indeterminate" id="progressBar"></div>
      </div>
      <div class="log-box" id="logBox"></div>
    </div>

    <!-- DOWNLOAD -->
    <div id="download-section">
      <h3>âœ… Video Ready!</h3>
      <p>Your iMessage video has been generated successfully.</p>
      <a class="dl-btn" id="downloadBtn" href="#" download>
        â¬‡ Download MP4
      </a>
    </div>
  </div>
</div>

<script>
// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let selectedProvider = null;
let selectedTheme    = 'dark';
let pollInterval     = null;
let currentJobId     = null;

// â”€â”€ Landing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectProvider(p) {
  selectedProvider = p;

  // Animate transition
  const landing = document.getElementById('landing');
  landing.style.transition = 'opacity 0.3s, transform 0.3s';
  landing.style.opacity = '0';
  landing.style.transform = 'translateY(-12px)';

  setTimeout(() => {
    landing.style.display = 'none';
    const app = document.getElementById('app');
    app.style.display = 'block';
    app.style.opacity = '0';
    app.style.transition = 'opacity 0.35s';
    requestAnimationFrame(() => { app.style.opacity = '1'; });
    applyProvider();
  }, 280);
}

function backToLanding() {
  if (!confirm('Go back to provider selection? Current progress will be lost.')) return;
  clearInterval(pollInterval);
  const app = document.getElementById('app');
  app.style.transition = 'opacity 0.25s';
  app.style.opacity = '0';
  setTimeout(() => {
    app.style.display = 'none';
    const landing = document.getElementById('landing');
    landing.style.display = 'flex';
    landing.style.opacity = '0';
    landing.style.transform = 'translateY(12px)';
    landing.style.transition = 'opacity 0.3s, transform 0.3s';
    requestAnimationFrame(() => { landing.style.opacity = '1'; landing.style.transform = ''; });
    resetUI();
  }, 260);
}

function applyProvider() {
  const badge     = document.getElementById('providerBadge');
  const badgeTxt  = document.getElementById('providerBadgeText');
  const genBtn    = document.getElementById('genBtn');
  const titleAcc  = document.getElementById('titleAccent');
  const hint      = document.getElementById('apiKeyHint');

  if (selectedProvider === 'elevenlabs') {
    badge.className     = 'provider-badge el';
    badgeTxt.textContent = 'ElevenLabs';
    genBtn.className     = 'gen-btn el';
    titleAcc.style.background = 'linear-gradient(90deg,#19e68c,#0db870)';
    hint.textContent    = 'Enter your ElevenLabs API key (xi-api-key)';
  } else {
    badge.className     = 'provider-badge ai';
    badgeTxt.textContent = 'AI33Pro';
    genBtn.className     = 'gen-btn ai';
    titleAcc.style.background = 'linear-gradient(90deg,#5b7fff,#3355cc)';
    hint.textContent    = 'Enter your AI33Pro API key';
  }
  titleAcc.style.webkitBackgroundClip = 'text';
  titleAcc.style.backgroundClip = 'text';
  titleAcc.style.webkitTextFillColor = 'transparent';
}

// â”€â”€ Form helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setTheme(t) {
  selectedTheme = t;
  document.getElementById('btn-dark').classList.toggle('active', t === 'dark');
  document.getElementById('btn-light').classList.toggle('active', t === 'light');
}

function handleScript(input) {
  if (!input.files.length) return;
  const zone = document.getElementById('scriptZone');
  const txt  = document.getElementById('scriptText');
  zone.classList.add('has-file');
  txt.textContent = 'âœ“ ' + input.files[0].name;
}

const extraAssets = [];
function handleAssets(input) {
  if (!input.files.length) return;
  Array.from(input.files).forEach(f => {
    if (!extraAssets.find(x => x.name === f.name)) extraAssets.push(f);
  });
  renderAssets();
}
function removeAsset(name) {
  const idx = extraAssets.findIndex(f => f.name === name);
  if (idx !== -1) extraAssets.splice(idx, 1);
  renderAssets();
}
function renderAssets() {
  const grid = document.getElementById('assetsGrid');
  grid.innerHTML = extraAssets.map(f => `
    <div class="asset-chip">
      <span>${f.name}</span>
      <span class="remove" onclick="removeAsset('${f.name}')">Ã—</span>
    </div>`).join('');
}
function handleSfx(input, which) {
  if (!input.files.length) return;
  const id = which === 'sent' ? 'sentText' : 'rcvdText';
  const zoneId = which === 'sent' ? 'sentZone' : 'rcvdZone';
  document.getElementById(id).textContent = 'âœ“ ' + input.files[0].name;
  document.getElementById(zoneId).classList.add('has-file');
}

// â”€â”€ Generate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generate() {
  const apiKey = document.getElementById('apiKey').value.trim();
  const scriptFile = document.getElementById('scriptFile').files[0];
  const errBox = document.getElementById('errorBox');
  errBox.classList.remove('visible');

  if (!scriptFile) return showError('Please upload a script .txt file.');
  if (!apiKey)     return showError('API key is required.');

  const fd = new FormData();
  fd.append('script',      scriptFile);
  fd.append('apiKey',      apiKey);
  fd.append('theme',       selectedTheme);
  fd.append('ttsProvider', selectedProvider);

  extraAssets.forEach(f => fd.append('assets', f));

  const sentFile = document.getElementById('sentSfx').files[0];
  const rcvdFile = document.getElementById('rcvdSfx').files[0];
  if (sentFile) fd.append('sentSfx',    sentFile);
  if (rcvdFile) fd.append('receivedSfx', rcvdFile);

  // UI: loading state
  const btn = document.getElementById('genBtn');
  btn.disabled = true;
  document.getElementById('genBtnIcon').innerHTML = '<span class="spin">â³</span>';
  document.getElementById('genBtnText').textContent = 'Startingâ€¦';

  // Hide download, show progress
  document.getElementById('download-section').classList.remove('visible');
  const prog = document.getElementById('progress-section');
  prog.classList.add('visible');
  document.getElementById('logBox').innerHTML = '';
  setStatus('queued');

  try {
    const resp = await fetch('/api/generate', { method: 'POST', body: fd });
    const data = await resp.json();
    if (!resp.ok) throw new Error(data.error || 'Server error');
    currentJobId = data.jobId;
    pollJob(currentJobId);
  } catch (e) {
    showError(e.message);
    resetBtn();
  }
}

function pollJob(jobId) {
  clearInterval(pollInterval);
  pollInterval = setInterval(async () => {
    try {
      const r  = await fetch(`/api/status/${jobId}`);
      const d  = await r.json();
      renderLog(d.log || []);
      setStatus(d.status);

      if (d.status === 'done') {
        clearInterval(pollInterval);
        showDownload(d.downloadUrl);
        resetBtn();
        document.getElementById('progress-section').classList.remove('visible');
      } else if (d.status === 'error') {
        clearInterval(pollInterval);
        showError(d.error || 'Unknown error');
        resetBtn();
      }
    } catch (_) {}
  }, 1800);
}

function renderLog(lines) {
  const box = document.getElementById('logBox');
  box.innerHTML = lines.map(l => {
    const cls = l.includes('âœ…') || l.includes('[TTS CACHE] HIT') ? 'ok'
              : l.includes('âŒ') || l.includes('[ERR]') ? 'err' : '';
    const safe = l.replace(/</g,'&lt;').replace(/>/g,'&gt;');
    return `<div class="log-line ${cls}">${safe}</div>`;
  }).join('');
  box.scrollTop = box.scrollHeight;
}

function setStatus(s) {
  const pill = document.getElementById('statusPill');
  const bar  = document.getElementById('progressBar');
  pill.className = `status-pill ${s}`;
  pill.textContent = s;
  if (s === 'running') {
    bar.classList.add('indeterminate');
  } else if (s === 'done') {
    bar.classList.remove('indeterminate');
    bar.style.width = '100%';
  } else if (s === 'error') {
    bar.classList.remove('indeterminate');
    bar.style.background = 'var(--danger)';
    bar.style.width = '100%';
  }
}

function showDownload(url) {
  const sec = document.getElementById('download-section');
  const btn = document.getElementById('downloadBtn');
  btn.href = url;
  sec.classList.add('visible');
}

function showError(msg) {
  const box = document.getElementById('errorBox');
  box.textContent = 'âš  ' + msg;
  box.classList.add('visible');
}

function resetBtn() {
  const btn = document.getElementById('genBtn');
  btn.disabled = false;
  document.getElementById('genBtnIcon').textContent = 'â–¶';
  document.getElementById('genBtnText').textContent = 'Generate Video';
}

function resetUI() {
  clearInterval(pollInterval);
  currentJobId = null;
  document.getElementById('progress-section').classList.remove('visible');
  document.getElementById('download-section').classList.remove('visible');
  document.getElementById('errorBox').classList.remove('visible');
  document.getElementById('logBox').innerHTML = '';
  document.getElementById('apiKey').value = '';
  document.getElementById('scriptFile').value = '';
  document.getElementById('scriptText').textContent = 'Drop your script.txt here';
  document.getElementById('scriptZone').classList.remove('has-file');
  extraAssets.length = 0;
  renderAssets();
  resetBtn();
}

// Drag feedback
['scriptZone','assetsZone'].forEach(id => {
  const el = document.getElementById(id);
  el.addEventListener('dragover',  e => { e.preventDefault(); el.classList.add('drag'); });
  el.addEventListener('dragleave', () => el.classList.remove('drag'));
  el.addEventListener('drop',      e => { e.preventDefault(); el.classList.remove('drag'); });
});
</script>
</body>
</html>